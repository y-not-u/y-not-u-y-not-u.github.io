<!DOCTYPE html><html lang="zh-cn,en,default"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Vue大型项目的探索 · Hexo</title><meta name="description" content="Vue大型项目的探索 - Vogan"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://www.vatery.com/atom.xml" title="Hexo"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"><span class="title">Hexo</span></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/y-not-u" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="mailto:voganwong@hotmail.com" target="_self" class="nav-list-link">MAIL</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Vue大型项目的探索</h1><div class="post-info space-between"><div>2021年4月12日</div><img src="https://api.visitorbadge.io/api/visitors?path=https%3A%2F%2Fwww.vatery.com%2F2021%2F04%2F12%2FVue%25E5%25A4%25A7%25E5%259E%258B%25E9%25A1%25B9%25E7%259B%25AE%25E7%259A%2584%25E6%258E%25A2%25E7%25B4%25A2%2F&amp;labelColor=%23d9e3f0&amp;countColor=%2337d67a&amp;style=flat" alt="visitors"></div><div class="post-content"><p>当一个 Vue 项目源文件达到 400 以上时，发现开发起来已经显得有些臃肿，本文就在多个方面进行一些模块化的尝试。</p>
<span id="more"></span>

<h2 id="更低程度的模块化"><a href="#更低程度的模块化" class="headerlink" title="更低程度的模块化"></a>更低程度的模块化</h2><p>通常 CLI 生成的项目结构都比较简单，易于上手。一般来说都会安装 Vuex、Vue Router 包进行配合开发，他们的默认结构大体是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├── App.vue</span><br><span class="line">├── assets</span><br><span class="line">├── main.js</span><br><span class="line">├── pages</span><br><span class="line">├── router</span><br><span class="line">└── store</span><br></pre></td></tr></table></figure>

<p>在小型项目中，开发完全没有问题，即使大型项目也是可以继续开发的，但是我们会发现一些问题，比如：</p>
<ul>
<li>router 中的 router.js 路由文件越来越大，十分复杂</li>
<li>store 中管理非常多的状态，混乱度增加</li>
<li>pages 主要业务文件夹中，页面列表越来越长，业务内聚力差</li>
</ul>
<p>在业务成长一定程度后，基调必定会确定下来，通过分析思考，我们可以在业务里提取出模块。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">├── App.vue</span><br><span class="line">├── assets</span><br><span class="line">├── main.js</span><br><span class="line">├── modules # 原pages</span><br><span class="line">│   ├── Business</span><br><span class="line">│   ├── Device</span><br><span class="line">│   ├── Search</span><br><span class="line">│   └── ...</span><br><span class="line">├── router</span><br><span class="line">└── store</span><br></pre></td></tr></table></figure>

<p>在此基础上，将 router 和 store 的配置，下放到每一个 module 去。这样主目录下的 router 和 store 都会变得比较简单。而在每个 module 中，router 和 store 都更密切的关联该模块。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">├── App.vue</span><br><span class="line">├── assets</span><br><span class="line">├── main.js</span><br><span class="line">├── modules # 原pages</span><br><span class="line">│   ├── Business</span><br><span class="line">│   │     ├── pages</span><br><span class="line">│   │     ├── index.js</span><br><span class="line">│   │     ├── router.js</span><br><span class="line">│   │     └── store.js</span><br><span class="line">│   ├── Device</span><br><span class="line">│   ├── Search</span><br><span class="line">│   └── ...</span><br><span class="line">├── router</span><br><span class="line">└── store</span><br></pre></td></tr></table></figure>

<h2 id="视图、业务逻辑分离"><a href="#视图、业务逻辑分离" class="headerlink" title="视图、业务逻辑分离"></a>视图、业务逻辑分离</h2><p>Vue 快速开发的特色之一，就是在单一的一个 vue 文件中，可以写入 template、js 和 css，开发者不需要切换多个页面。但是在大型的表单类页面中，需求上设计的就非常复杂，不考虑各种优化的情况下，页面代码量可能达到 1000 行以上，在这种页面中进行修改和增加新的代码极容易出现问题。</p>
<p>当然，解决方案之一是组件化，但是对于表单来说，整个表单就是多个组件组合而成，而且本身表单组件也复杂，所以组件化只能解决部分问题。</p>
<p>这里我提出的方案，灵感来自于 AngularJS 的文件结构和 Vue Router 中的<code>mapActions</code>方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user</span><br><span class="line">├── index.vue</span><br><span class="line">└── index.service.js</span><br></pre></td></tr></table></figure>

<p>将部分复杂的逻辑，抽取到<code>index.service.js</code>中，如何引入到<code>index.vue</code>中呢？</p>
<p>非常简单：</p>
<p>File: <code>index.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tempate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> mapServices <span class="keyword">from</span> <span class="string">&#x27;@/utils/service.js&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> service <span class="keyword">from</span> <span class="string">&#x27;./index.service.js&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="title function_">fetchData</span>() <span class="comment">// 直接调用map进来的方法</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    ...<span class="title function_">mapServices</span>(service)([</span></span><br><span class="line"><span class="language-javascript">      <span class="string">&#x27;login&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="string">&#x27;logout&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="string">&#x27;register&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="string">&#x27;fetchData&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    ])</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>File: <code>index.service.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">login</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">logout</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">register</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  login,</span><br><span class="line">  logout,</span><br><span class="line">  register,</span><br><span class="line">  fetchData,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>File: <code>@/utils/service.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">mapServices</span>(<span class="params">services</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!services) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(props)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;mapServices only accept an Array&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> funcs = &#123;&#125;;</span><br><span class="line">    props.<span class="title function_">forEach</span>(<span class="function">(<span class="params">propName</span>) =&gt;</span> &#123;</span><br><span class="line">      services[propName] &amp;&amp; (funcs[propName] = services[propName]);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> funcs;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种方式即可将逻辑分散到其他文件中，并在 vue 主文件中，也不失关联性的，能够自然开发。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2021/05/07/Taro%E5%BC%80%E5%8F%91%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%BB%8F%E9%AA%8C/" class="prev">上一篇</a><a href="/2020/09/08/Create-React-App-Multi-Entry-Points/" class="next">下一篇</a></div><script src="https://utteranc.es/client.js" repo="y-not-u/y-not-u.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script><div class="copyright"><p>© 2016 - 2024 <a href="https://www.vatery.com">Vogan</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);})(window, document, "clarity", "script","l6ok4h42je");</script><script defer src="https://cloud.umami.is/script.js" data-website-id="4d516321-c1cf-4643-ad1e-2900a14d72f4"></script></body></html>